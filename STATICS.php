<?php

$_COOKIE['username']='csr';
$_COOKIE['password']='csr';
require_once('config.php');
// 29746
$statics['94ccb94c5093']='38.108.138.74';

// Plaza
$statics['00259c4e7658']='38.108.141.174';

// CrossCreek
// OLD ENTRY $statics['000c414d3d6d']='38.108.140.77';
$statics['0006b1067f3a']='38.108.140.77';

// OakCrossing
$statics['001d7e479aec']='38.108.140.206';

// Dave
$statics['3c0754122ea1']='38.108.141.66';

// Fire Panel 6699
//$statics['00034f032df5']='38.108.138.175';
$statics['00034f03c30d']='38.108.138.175';

// Joe Barcus TEST
// 38.108.140.118  dhcp    94cc.b94c.506f
$statics['94ccb94c506f'] = '38.108.140.118';
// Frank Tribble
// 38.108.139.115  dhcp    001c.11f5.3fd5
$statics['001c11f53fd5'] = '38.108.139.115';

// Office Test
// 38.108.138.38   dhcp    e483.9972.99e5
$statics['e483997299e5'] = '38.108.138.38';

// Mansions Corporate
$statics['0021431df91c'] = '38.108.139.102';

// 29140
$statics['0023ed9afb8e'] = '38.108.138.9';

// 29128
$statics['145bd1c0ae0c'] = '38.108.140.182';

// 0023ed9b01e7,   28361, needs a sticky ip
$statics['001c11f53fee'] = '38.108.138.10';

// 29186
$statics['0024a18c13c8'] = '38.108.138.253';

// 29440
$statics['001c11422a9f'] = '38.108.138.208';
// 29128 
// 38.108.142.70   dhcp    145b.d1c0.ae0c
$statics['145bd1c0ae0c'] = '38.108.142.70';

// 29528
// 38.108.138.144  dhcp    7cbf.b17d.53ca  N 
$statics['7cbfb17d53ca'] = '38.108.138.144';

// 28101
// 38.108.138.111  dhcp    e483.9972.99ee
$statics['e483997299ee'] = '38.108.138.111';


// 15698
// 38.108.138.183  dhcp    0024.a18c.1442
$statics['0024a18c1442'] = '38.108.138.183';

// 29447
// 38.108.138.252  dhcp    0024.a18c.1463
$statics['0024a18c1463'] = '38.108.138.252';

// 27586
// 38.108.138.236  dhcp    0024.a18c.37a0  N 
$statics['0024a18c37a0'] = '38.108.138.236';

// 29930
// 38.108.138.71   dhcp    e483.9972.976c
$statics['e4839972976c'] = '38.108.138.71';

//
// 30142
// 38.108.138.227  dhcp    001c.1142.2a75  N 
$statics['001c11422a75'] = '38.108.138.227';

$statics['001c11422ab9'] = '38.108.138.117';
$statics['e48399729796'] = '38.108.138.123';


// weston office
$statics['442b037ed3cf'] = '38.108.141.83';

// 30609
$statics['001c11f53fee'] = '38.108.138.10';

// 30648
$statics['001c11422a9e'] = '38.108.141.24';
// 30613
$statics['001c11f53fed'] = '38.108.138.32';
// 30130, 38.108.141.207, 7896.84bf.da2d
$statics['789684bfda2d'] = '38.108.141.207';
// 30724
$statics['e86d5281d414'] = '38.108.141.130';

// 30679, Nicks wants sticky ip on this, e483.9972.9796, 38.108.138.123
$statics['e48399729796'] = '38.108.138.123';
//
// 30718
$statics['0024a18c13fa']='38.108.141.60';
// 
$statics['001c11f53953']='38.108.138.12';
// 30780, 38.108.141.116, 3cdf.a93a.b0e6
$statics['3cdfa93ab0e6']='38.108.141.116';
// 30769, pb816.19fb.8c4c, 38.108.140.2
$statics['b81619fb8c4c']='38.108.140.2';
//  5000, 14d6.4d2b.015d, 38.108.138.5
$statics['14d64d2b015d']='38.108.138.5';
//  29881, mac cc7d.376b.d5d4, ip 38.108.140.131
$statics['cc7d376bd5d4']='38.108.140.131';
// 30039, ip 38.108.140.199, mac 20aa.4ba4.7375
$statics['20aa4ba47375']='38.108.140.199';
// 30756, 38.108.138.8, e86d.5275.eef6
$statics['e86d5275eef6']='38.108.138.8';
//  30833, 38.108.138.72, 6455.b13c.f33b
$statics['6455b13cf33b']='38.108.138.72';
//  6507 10.1.4.228      38.108.138.81   dhcp    0024.a18c.146c
$statics['0024a18c146c']='38.108.138.81';
// 30854, cc65.ad34.8516, 38.108.141.111
$statics['cc65ad348516']='38.108.141.111';
//  30875, mac e86d.5275.eea5, ip 38.108.138.167
$statics['e86d5275eea5'] = '38.108.138.167';
// 30844, mac d039.b318.fc60, ip 38.108.141.127
$statics['d039b318fc60'] = '38.108.141.127';
// 30900, mac e86d.5275.f037, ip 38.108.139.68
$statics['e86d5275f037'] = '38.108.139.68';
// 30868, mac e86d.5281.d45f, ip 38.108.138.223
$statics['e86d5281d45f']='38.108.138.223';
// 30788, mac e86d.5281.d444, ip 38.108.139.111
$statics['e86d5281d444']='38.108.139.111';
// 30617, mac e86d.5281.d43b, ip 38.108.140.123
$statics['e86d5281d43b']='38.108.140.123';
// mac 001c.11f5.3959, ip 38.108.140.39, acct. 30906
$statics['001c11f53959']='38.108.140.39';
// mac e86d.5275.e57b, ip 38.108.140.82, acct. 30887
$statics['e86d5275e57b']='38.108.140.82';
// 30780, mac 3cdf.a93a.d4f8, ip 38.108.141.114
$statics['3cdfa93ad4f8']='38.108.141.114';
// 30934, mac 001c.1142.2a61, ip 38.108.139.35
$statics['001c11422a61']='38.108.139.35';
// 30813, mac e86d.5281.d468, ip 38.108.141.138
$statics['e86d5281d468']='38.108.141.138';
// 30899, mac e86d.5281.d46e, ip 38.108.138.77
$statics['e86d5281d46e']='38.108.138.77';
// 30617, mac e86d.5281.d429, ip 38.108.141.217
$statics['e86d5281d429']='38.108.141.217';
// Acct# 27634 7cbf.b17d.b87a, ip 38.108.138.13
$statics['7cbfb17db87a']='38.108.138.13';
// 30918, mac e86d.5275.d483, ip 38.108.141.223
$statics['e86d5275d483']='38.108.141.223';
// 30908, mac e86d.5281.d42c, ip 38.108.140.251
$statics['e86d5281d42c']='38.108.140.251';
// 30921 38.108.138.68   dhcp    e86d.5281.d3e7
$statics['e86d5281d3e7']='38.108.138.68';
// acct 30808 mac 0021.431d.abac ip  38.108.139.85
$statics['0021431dabac']='38.108.139.85';
// acct 30957, mac 94cc.b94c.5147, ip 38.108.138.222
$statics['94ccb94c5147']='38.108.138.222';
// acct. 30919, mac e86d.5275.f01f, ip 38.108.138.164
$statics['e86d5275f01f']='38.108.138.164';
// acct 30949, mac e86d.5275.f049, ip 38.108.138.184
$statics['e86d5275f049']='38.108.138.184';
// acct 29676, mac e86d.5281.d45c, ip 38.108.138.248
$statics['e86d5281d45c']='38.108.138.248';
// acct. 30877, mac e86d.5275.f061, ip 38.108.140.42
$statics['e86d5275f061']='38.108.140.42';
// acct. 30818, mac e86d.5281.d3d5, ip 38.108.141.252
$statics['e86d5281d3d5']='38.108.141.252';
// acct. 30928, mac e86d.5204.b881, ip 38.108.141.194
$statics['e86d5204b881']='38.108.138.224';
// acct 30974  38.108.138.221  dhcp    0024.a18c.145c
$statics['0024a18c145c']='38.108.138.221';
// acct 199, mac e86d.5281.b8f9, ip 38.108.138.87
$statics['e86d5281b8f9']='38.108.138.87';
// acct 31010, 38.108.141.194  dhcp    e86d.5275.eed2
$statics['e86d5275eed2']='38.108.141.194';
// 31019 38.108.141.164  dhcp    0024.a18c.13cd
$statics['0024a18c13cd']='38.108.141.164';
// 31018 38.108.138.59   dhcp    001c.fb07.80af
$statics['001cfb0780af']='38.108.138.59';
// 31013        38.108.138.158  dhcp    0024.a18c.1464  N
$statics['0024a18c1464']='38.108.138.158';
// acct 30432, mac 94cc.b94c.5075, ip 38.108.140.26
$statics['94ccb94c5075']='38.108.140.26';
// e86d.5204.b7df, ip 38.108.139.44, acct. 31062
$statics['e86d5204b7df']='38.108.139.44';
// 31055, mac 001c.1142.2a48, ip 38.108.140.179
$statics['001c11422a48']='38.108.140.179';
// e86d.5281.d375, ip 38.108.141.233, acct. 31066
$statics['e86d5281d375']='38.108.141.233';
// add sticky ip, acct 30830, mac 6455.b13c.7cee, ip 38.108.138.114
$statics['6455b13c7cee']='38.108.138.114';
// mac 0021.431c.9ba8, ip 38.108.140.72, acct. 31070
$statics['0021431c9ba8']='38.108.140.72';
// 31088, mac 8461.a07a.0757, ip 38.108.138.241
$statics['8461a07a0757']='38.108.138.241';
// 30756, e86d.5275.eef6, 38.108.138.8
$statics['e86d5275eef6']='38.108.138.8';
// 30976, 0021.431d.fa96, 38.108.138.179
$statics['0021431dfa96']='38.108.138.179';
// 30900, e86d.5275.f037, 38.108.139.68
$statics['e86d5275f037']='38.108.139.68';
// 31012 38.108.141.47   dhcp    0024.a18c.13c6
$statics['0024a18c13c6']='38.108.141.47';
// 31114, mac 0021.431d.f68e, ip 38.108.140.107
$statics['0021431df68e']='38.108.140.107';
// 30852, mac e86d.5275.f019, ip 38.108.138.70
$statics['e86d5275f019']='38.108.138.70';
// 31119, mac b816.19ea.ab70, ip 38.108.140.211
$statics['b81619eaab70']='38.108.140.211';
// 31121, mac 1005.b1b1.b5c2, ip 38.108.138.229
$statics['1005b1b1b5c2']='38.108.138.229';
// cct 30894, mac 14dd.a998.1220, ip 38.108.139.119
$statics['14dda9981220']='38.108.139.119';
// 31130, 3cdf.a93b.66c3, 38.108.140.173
$statics['3cdfa93b66c3']='38.108.140.173';
// 31075 -- 38.108.140.36   dhcp    3cdf.a93a.3efe  N
$statics['3cdfa93a3efe']='38.108.140.36';
// 17974, 1005.b1b1.9c3f, 38.108.139.21, needs a sticky ip
$statics['1005b1b19c3f']='38.108.139.21';
// 31085, a47a.a465.8284, 38.108.140.9
$statics['a47aa4658284']='38.108.140.9';
// 31140, 8c7f.3b34.8904, 38.108.138.52
$statics['8c7f3b348904']='38.108.138.52';
// 31136, 3cdf.a9f2.d69c, 38.108.139.28
$statics['3cdfa9f2d69c']='38.108.139.28';
// 30994, e86d.5281.d36f, 38.108.139.26,
$statics['e86d5281d36f']='38.108.139.26';
// 31097, b816.19fd.6e3e, 38.108.140.184
$statics['b81619fd6e3e']='38.108.140.184';
// 31137, 38.108.141.4, e86d.5275.ef23
$statics['e86d5275ef23']='38.108.141.4';
// 31148, 38.108.140.183, 1005.b1b2.4bbc
$statics['1005b1b24bbc']='38.108.140.183';
// 31150, 38.108.138.222, 94cc.b94c.5147
$statics['94ccb94c5147']='38.108.138.222';
// 31160, 38.108.141.176, b816.19fc.5da4
$statics['b81619fc5da4']='38.108.141.176';
// 31158, 38.108.139.28, 3cdf.a9f2.d69c
$statics['3cdfa9f2d69c']='38.108.139.28';
// 31165, 38.108.141.115, b816.19ea.934c
$statics['b81619ea934c']='38.108.141.115';
// 31154, 38.108.139.82, 0024.a18c.146d, needs a sticky
$statics['0024a18c146d']='38.108.139.82';
// 30783, 38.108.140.118,  94cc.b94c.506f
$statics['94ccb94c506f']='38.108.140.118';
// 31177, 38.108.140.82, e86d.5275.e57b
$statics['e86d5275e57b']='38.108.140.82';
// , 31187, 38.108.141.46, e86d.5204.f1d5
$statics['e86d5204f1d5']='38.108.141.46';
// 31159, 38.108.141.62, 001c.1142.2a53
$statics['001c11422a53']='38.108.141.62';
// 31194, 38.108.139.78, a063.915c.73b1
$statics['a063915c73b1']='38.108.139.78';
// 31183, 38.108.139.9, 3cdf.a9f2.a642
$statics['3cdfa9f2a642']='38.108.139.9';
// 31201, 38.108.141.216, e483.99a7.0093
$statics['e48399a70093']='38.108.141.216';
// 31191, 38.108.141.58, e483.996c.77e3
$statics['e483996c77e3']='38.108.141.58';
// 31155, 38.108.140.106, e483.99a7.05d3
$statics['e48399a705d3']='38.108.140.106';
// 31108, 38.108.140.78, 1005.b1b1.9987
$statics['1005b1b19987']='38.108.140.78';
// 31191, e483.99a6.fbf7, 38.108.140.180
$statics['e48399a6fbf7']='38.108.140.180';





$db = connect();
$sql="UPDATE dhcp_leases SET dynamic_flag='YES' WHERE dynamic_flag='NO'";
$db->query($sql);
foreach($statics as $k=>$v) {
	$mac = $k;
	$ip  = $v;
	$endTstamp=time()+86400;
	$start = date('Y-m-d h:i:s');
	$end   = date('Y-m-d h:i:s',$endTstamp);
	$sql = "INSERT INTO dhcp_leases VALUES ('{$ip}','{$mac}','{$start}','{$end}','{$start}','NO','NO','NEWPC','999999','abcd1234abcd','1','','1')";
	$sql.= " ON DUPLICATE KEY UPDATE dynamic_flag='NO', end_time='{$end}'";
	print $sql; print "\n";
	$db->query($sql);
}

$sql="insert into dhcp_oldleases select *,now() from dhcp_leases WHERE end_time < now()";
$db->query($sql);

$sql="DELETE FROM dhcp_leases WHERE end_time < now() AND dynamic_flag='YES'";
$db->query($sql);

$sqlAR[0]['sql']="SELECT count(ipaddr) FROM dhcp_leases WHERE ipaddr like '38.108.138.%'";
$sqlAR[0]['min']=180;
$sqlAR[0]['update']="UPDATE config_nets SET full_flag='NO' WHERE network='38.108.138.0/24' AND full_flag='YES'";

$sqlAR[1]['sql']="SELECT count(ipaddr) FROM dhcp_leases WHERE ipaddr like '38.108.139.%'";
$sqlAR[1]['min']=80;
$sqlAR[1]['update']="UPDATE config_nets SET full_flag='NO' WHERE network='38.108.139.0/25' AND full_flag='YES'";

$sqlAR[2]['sql']="SELECT count(ipaddr) FROM dhcp_leases WHERE ipaddr like '38.108.140.%'";
$sqlAR[2]['min']=180;
$sqlAR[2]['update']="UPDATE config_nets SET full_flag='NO' WHERE network='38.108.140.0/24' AND full_flag='YES'";

$sqlAR[3]['sql']="SELECT count(ipaddr) FROM dhcp_leases WHERE ipaddr like '38.108.141.%'";
$sqlAR[3]['min']=180;
$sqlAR[3]['update']="UPDATE config_nets SET full_flag='NO' WHERE network='38.108.141.0/24' AND full_flag='YES'";

$sqlAR[4]['sql']="SELECT count(ipaddr) FROM dhcp_leases WHERE ipaddr like '38.108.142.%' OR ipaddr like '38.108.143.%'";
$sqlAR[4]['min']=350;
$sqlAR[4]['update']="UPDATE config_nets SET full_flag='NO' WHERE network='38.108.142.0/23' AND full_flag='YES'";

foreach ($sqlAR as $s) {
	$sql = $s['sql'];
	$min = $s['min'];
	$upd = $s['update'];
	$rset = $db->query($sql);
	if(PEAR::isError($rset)) {
		print $sql."\n";
		print $rset->getMessage()."\n";
		exit();
	}
	$row=$rset->fetchRow();
	$count = $row['count(ipaddr)'];
	print $sql.' -- '.$count." \n";
	if($count <= $min) {
		$rrset=$db->query($upd);
		print $upd."\n";
		if(PEAR::isError($rrset)) {
			print $rrset->getMessage()."\n";
		}
	}
}

?>
